% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dpit_nb.R
\name{dpit_nb}
\alias{dpit_nb}
\title{Residuals for regression models with negative binomial outcomes}
\usage{
dpit_nb(fitted, y=NULL, size=NULL, plot = TRUE, scale="uniform")
}
\arguments{
\item{fitted}{Numeric vector of fitted means.}

\item{y}{Outcome variable.}

\item{size}{Dispersion (size) parameter for the negative binomial distribution; e.g., a \code{glm.nb} fitted with a negative‐binomial family, you can extract it with \code{summary(model)$theta}.}

\item{plot}{Logical; if \code{TRUE} (default) a QQ-plot of the residuals is displayed.}

\item{scale}{You can choose the scale of the residuals among normal and uniform scales. The sample quantiles of the residuals are plotted against the theoretical quantiles of a standard normal distribution under the normal scale, and against the theoretical quantiles of a uniform (0,1) distribution under the uniform scale. The default scale is normal}
}
\value{
DPIT residuals and their mean CRPS. If \code{plot=TRUE}, also produces a QQ plot.
}
\description{
Calculates Double Probability Integral Transform (DPIT) residuals for
regression model whose response follows a negative binomial distribution.
Unlike \code{resid_disc}, which infers the fitted CDF from a model object,
\code{dpit_nb} requires only the vector of fitted means and a dispersion parameter, so it can be applied
to GLMs, GAMs, or other custom estimators—as long as fitted values are available.
}
\examples{
library(assessor)
library(mgcv)
set.seed(1234)
n  <- 500
x1 <- runif(n, 0, 1)
x2 <- runif(n, 0, 1)
f1 <- function(x)  2 * sin(2*pi*x)
f2 <- function(x) -1.5 * (x - .5)^2
eta <- -0.5 + f1(x1) + f2(x2)
mu  <- exp(eta)
theta_true <- 1.3
y <- rnbinom(n, size = theta_true, mu = mu)
dat <- data.frame(y, x1, x2)
gam_nb <- gam(y ~ s(x1) + s(x2),
              family = nb(),
              data   = dat,
              method = "REML")
gam_pois <- gam(y ~ s(x1) + s(x2),
                family = poisson(),
                data = dat,
                method = "REML")
dpit_nb(gam_nb$fitted.values, y=y, size=gam_nb$family$getTheta(TRUE))
dpit_pois(gam_pois$fitted.values, y=y)
}
\references{
Yang, Lu. "Double Probability Integral Transform Residuals for Regression Models with Discrete Outcomes." arXiv preprint arXiv:2308.15596 (2023).
}
